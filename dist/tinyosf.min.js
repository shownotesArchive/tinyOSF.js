/* * * * * * * * * *
 *   tinyOSF .js   *
 *  Version 0.3.7  *
 *  License:  MIT  *
 * Simon  Waldherr *
 * * * * * * * * * */

String.prototype.trim||(String.prototype.trim=function(){"use strict";return this.replace(/^\s+|\s+$/g,"")}),String.prototype.trimSC||(String.prototype.trimSC=function(){"use strict";return this.replace(/^[\s\.;:,_]+|[\s\.\-;:,_]+$/g,"")});var tinyosf={containsTag:function(a,b){"use strict";var c;if(void 0!==a&&void 0!==b)for(c=0;c<a.length;c+=1)if(-1!==b.indexOf(a[c]))return!0;return!1},extractTags:function(a,b){"use strict";var c,d,e,f=[],g=[];for(g=a.split(" "),c=0;c<g.length;c+=1)e=g[c].replace("#","").trim(),1===e.length?"c"===e?f.push("chapter"):"t"===e?f.push("topic"):"g"===e?f.push("glossary"):"l"===e?f.push("link"):"p"===e?f.push("prediction"):"s"===e?f.push("section"):"v"===e?f.push("video"):"a"===e?f.push("audio"):"i"===e?f.push("image"):"q"===e?f.push("quote"):"r"===e&&f.push("revision"):e.length>2&&f.push(e);return b!==!1&&-1!==b.indexOf("/")&&(d=b.split("/"),d=0===d[1].length?d[2].split("."):d[0].split("."),Array.isArray(d)&&f.push(d[d.length-2]+d[d.length-1])),f},buildTags:function(a,b,c){"use strict";var d,e="";for(d=0;d<a.length;d+=1)"string"==typeof a[d]&&a[d].trim().length>3&&(2===b?e+=" osf_"+a[d]:1===b?(""!==e&&(e+=", "),e+=a[d]):(""!==e&&(e+=" "),e+="#"+a[d]));return c===!0?' class="'+e+'"':e},timestampsToHMS:function(a,b){"use strict";var c,d,e,f=parseFloat(a)-parseFloat(b),g="";return c=Math.floor(f/3600),d=Math.floor((f-3600*c)/60),e=f-3600*c-60*d,g+=10>c?"0"+c+":":c+":",g+=10>d?"0"+d+":":d+":",g+=10>e?"0"+e.toFixed(3):e.toFixed(3)},HMSToTimeFloat:function(a){"use strict";var b,c=0,d=/((\d+\u003A)?(\d+\u003A)?(\d+)(\u002E\d+)?)/;if(void 0!==a)return b=d.exec(a.trim()),null===b?void 0:(void 0===b[5]?b[5]="000":(b[5]=b[5]+"000",b[5]=b[5].substr(1,3)),c+=3600*parseInt(b[2],10),c+=60*parseInt(b[3],10),c+=parseInt(b[4],10),c+=parseFloat("0."+b[5]),c)},TimeIntToHMS:function(a){"use strict";return tinyosf.timestampsToHMS(a,0)},htmldecode:function(a){"use strict";var b=document.createElement("div");return b.innerHTML=a,a=b.innerText||b.textContent,b=void 0,a},htmlencode:function(a){"use strict";if(void 0===document)return require("htmlencode").htmlEncode(a);var b=document.createElement("div");return b.appendChild(document.createTextNode(a)),a=b.innerHTML,b=void 0,a},Parser:function(a){"use strict";var b,c,d,e,f,g,h,i=0,j=!1,k=[],l=/(^([(\d{8,})((\d+\u003A)?\d+\u003A\d+(\u002E\d+)?)]*)?\h*([^#<>\n\v]+) *(\u003C[\S]*\u003E)?((\s*\u0023[\S]* ?)*)\n*)/gim;for(-1!==a.indexOf("/HEADER")?j="/HEADER":-1!==a.indexOf("/HEAD")&&(j="/HEAD"),"string"==typeof j?a=a.split(j,2)[1].trim():(j=a.split(/([(\d{8,})((\d+\u003A)?\d+\u003A\d+(\u002E\d+)?)]+\s*\S)/i,3),j=a.indexOf(j[1]),a=a.slice(j)),a="\n"+a.replace(/\s+/," ")+"\n",b=l.exec(a);null!==b;)b[3]=b[3].trimSC(),b[3].replace(/[\s\d\.:\-]+/gim,"").length>2&&(b[0]=b[0].trim(),d=b[2],/(\d{8,})/.test(d)?(d=parseInt(d,10),void 0===g&&(g=d),e=tinyosf.timestampsToHMS(d,g),f=d-g):/((\d+\u003A)?\d+\u003A\d+(\u002E\d+)?)/.test(d)?(f=tinyosf.HMSToTimeFloat(d),e=tinyosf.TimeIntToHMS(f),void 0===h&&(h=d)):(e=!1,f=!1),b[1]=e,b[2]=f,b[6]=0,/^[\-\–\—]+/.test(b[3])&&(c=/^[\-\–\—]+/.exec(b[3]),void 0!==c&&void 0!==c[0]&&(b[6]=c[0].length,b[3]=b[3].substr(b[6]).trim())),b[3]=(" "+tinyosf.htmlencode(b[3])+" ").toString().replace(' "'," &#8222;").replace('" ',"&#8220; ").trim(),k[i]=b,i+=1),b=l.exec(a);return k},Export:function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l={},m="",n={};for(m+=b("","pre"),l.afterChapter=0,l.nextisChapter=!1,c=0;c<a.length;c+=1)d=a[c],k=d[1],j=d[2],e=d[3],g="string"==typeof d[4]?d[4].replace(/\u003C/,"").replace(/\u003E/,""):!1,f=tinyosf.extractTags(d[5],g),-1!==f.indexOf("chapter")?l.afterChapter=0:l.afterChapter+=1,void 0!==a[c+1]&&(l.nextisChapter=-1!==tinyosf.extractTags(a[c+1][5],!1).indexOf("chapter")?!0:!1),n.prev=void 0!==a[c-1]?a[c-1][6]:0,n.curr=a[c][6],n.next=void 0!==a[c+1]?a[c+1][6]:0,void 0!==a[c][2]&&a[c][2]!==!1&&(i=a[c][2]),void 0!==a[c+1]&&(h=void 0!==a[c+1][2]&&a[c+1][2]!==!1?a[c+1][2]:i),void 0!==d&&void 0!==b&&(m+=b({timeSec:j,timeSecLast:i,timeSecNext:h,timeHMS:k,osftext:e,osfline:d,url:g,tags:f,iteminfo:l,rank:n}));return m+=b("","post")}};"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.tinyosf=tinyosf);var osfExportTemp,osfExportModules={html:function(a,b){"use strict";var c,d;return void 0!==b?"":void 0===tinyosf.includetags||tinyosf.containsTag(tinyosf.includetags,a.tags)?(c="number"==typeof a.timeSec?a.url!==!1?'<a data-tooltip="'+a.timeSec+'" title="'+a.timeHMS+": "+a.osftext+" ("+tinyosf.buildTags(a.tags,1,!1)+')" '+tinyosf.buildTags(a.tags,2,!0)+' href="'+a.url+'">'+a.osftext+"</a>":'<span data-tooltip="'+a.timeSec+'" '+tinyosf.buildTags(a.tags,2,!0)+' title="'+a.timeHMS+": "+a.osftext+" ("+tinyosf.buildTags(a.tags,1,!1)+')">'+a.osftext+"</span>":a.url!==!1?"<a"+tinyosf.buildTags(a.tags,2,!0)+' title="'+a.osftext+" ("+tinyosf.buildTags(a.tags,1,!1)+')" href="'+a.url+'">'+a.osftext+"</a>":"<span"+tinyosf.buildTags(a.tags,2,!0)+' title="'+a.osftext+" ("+tinyosf.buildTags(a.tags,1,!1)+')">'+a.osftext+"</span>",-1!==a.tags.indexOf("chapter")?(c="<h2>"+c+" <small>("+a.timeHMS.substr(0,8)+")</small></h2>",d=c):d=c+"; ",d):""},newhtml:function(a,b){"use strict";var c,d;return void 0!==b?"":(c="number"==typeof a.timeSec?a.url!==!1?'<a data-tooltip="'+a.timeSec+'" '+tinyosf.buildTags(a.tags,2,!0)+' href="'+a.url+'">'+a.osftext+"</a>":'<span data-tooltip="'+a.timeSec+'" '+tinyosf.buildTags(a.tags,2,!0)+">"+a.osftext+"</span>":a.url!==!1?"<a"+tinyosf.buildTags(a.tags,2,!0)+' href="'+a.url+'">'+a.osftext+"</a>":"<span"+tinyosf.buildTags(a.tags,2,!0)+">"+a.osftext+"</span>",-1!==a.tags.indexOf("chapter")?(c="<h2>"+c+" <small>("+a.timeHMS.substr(0,8)+")</small></h2>",d=c):d=c+"; ",d)},htmllist:function(a,b){"use strict";var c,d,e,f="",g="";if(void 0!==b)return"post"===b?"</ol>":"pre"===b?"":"";if(void 0!==tinyosf.includetags&&!tinyosf.containsTag(tinyosf.includetags,a.tags))return"";if(c="number"==typeof a.timeSec?a.url!==!1?'<a data-tooltip="'+a.timeSec+'" title="'+a.timeHMS+": "+a.osftext+" ("+tinyosf.buildTags(a.tags,1,!1)+')" '+tinyosf.buildTags(a.tags,2,!0)+' href="'+a.url+'">'+a.osftext+"</a>":'<span data-tooltip="'+a.timeSec+'" '+tinyosf.buildTags(a.tags,2,!0)+' title="'+a.timeHMS+": "+a.osftext+" ("+tinyosf.buildTags(a.tags,1,!1)+')">'+a.osftext+"</span>":a.url!==!1?"<a"+tinyosf.buildTags(a.tags,2,!0)+' title="'+a.osftext+" ("+tinyosf.buildTags(a.tags,1,!1)+')" href="'+a.url+'">'+a.osftext+"</a>":"<span"+tinyosf.buildTags(a.tags,2,!0)+' title="'+a.osftext+" ("+tinyosf.buildTags(a.tags,1,!1)+')">'+a.osftext+"</span>",-1!==a.tags.indexOf("chapter")){for(d="",e=0;e<a.rank.prev;e+=1)d+="</ol>";c=d+"<h"+(a.rank.curr+2)+"><span>"+a.timeHMS.substr(0,8)+"</span> "+c+"</h"+(a.rank.curr+2)+">",f=c}else{if(1===a.iteminfo.afterChapter)g+="<ol>";else if(a.rank.prev>a.rank.curr)for(e=0;e<a.rank.prev-a.rank.curr;e+=1)g+="</ol>";if(a.rank.prev<a.rank.curr)for(e=0;e<a.rank.curr-a.rank.prev;e+=1)g+="<ol>";f=g+"<li>"+c+"</li>",a.iteminfo.nextisChapter===!0&&(f+="</ol>")}return f},markdown:function(a,b){"use strict";var c,d,e,f;if(void 0!==b)return"";if(void 0!==tinyosf.includetags&&tinyosf.includetags.length>0&&!tinyosf.containsTag(tinyosf.includetags,a.tags))return"";if(a.url!==!1?(a.url=a.url.replace(/[\(\)]/gim,function(a){return window.escape(a)}),c="["+a.osftext+"]("+a.url+")"):c=a.osftext,-1!==a.tags.indexOf("chapter")){for(e="#",f=0;f<a.rank.curr;f+=1)e+="#";c="\n#"+e+c+" ```"+a.timeHMS.substr(0,8)+"```  ",d=c}else if(e="",0!==a.rank.curr&&1!==a.iteminfo.afterChapter){for(f=0;f<a.rank.curr;f+=1)e+="    ";d=e+"*"+" "+c}else d="* "+c+"  ";return"\n"+d},audacity:function(a,b){"use strict";var c,d,e,f,g;if(void 0!==b)return"";if(c=a.url!==!1?a.osftext+" &lt;"+a.url+"&gt;":a.osftext,e="",0!==a.rank.curr)for(f=1;f<a.rank.curr;f+=1)e+="-";return g=a.timeSec!==!1?a.timeSec:a.timeSecLast,d=g+".000000"+"	"+a.timeSecNext+".000000"+"	"+e+" "+c,d+=" "+tinyosf.buildTags(a.tags,0,!1),"\n"+d},audacitychapter:function(a,b){"use strict";var c,d,e,f,g;if(void 0!==b)return"";if(-1!==a.tags.indexOf("chapter")){if(c=a.url!==!1?a.osftext+" &lt;"+a.url+"&gt;":a.osftext,e="",0!==a.rank.curr)for(f=1;f<a.rank.curr;f+=1)e+="-";return g=a.timeSec!==!1?a.timeSec:a.timeSecLast,d=g+".000000"+"	"+a.timeSecNext+".000000"+"	"+e+" "+c,d+=" "+tinyosf.buildTags(a.tags,0,!1),"\n"+d}return""},reaper:function(a,b){"use strict";var c,d,e,f,g,h=0;if("pre"===b)return osfExportTemp=0,"#,Name,Start,End,Length,Color";if(osfExportTemp+=1,void 0!==b)return"";if(c=a.url!==!1?a.osftext+" &lt;"+a.url+"&gt;":a.osftext,e="",0!==a.rank.curr){for(f=1;f<a.rank.curr;f+=1)e+="-";c+=e+" "}return a.timeSec!==!1?(g=a.timeSec,h=0):(h++,g=a.timeSecLast+h),d="M"+osfExportTemp+","+c+" "+tinyosf.buildTags(a.tags,0,!1)+","+tinyosf.TimeIntToHMS(g)+":0,"+",",d+=-1!==a.tags.indexOf("chapter")?",DD0F22":",","\n"+d},chapter:function(a,b){"use strict";return void 0!==b?"":-1!==a.tags.indexOf("chapter")?a.timeHMS+" "+a.osftext+"\n":""},mp4chaps:function(a,b){"use strict";return void 0!==b?"":-1!==a.tags.indexOf("chapter")?a.url!==!1?a.timeHMS+" "+a.osftext+" &lt;"+a.url+"&gt;"+"\n":a.timeHMS+" "+a.osftext+"\n":""},glossary:function(a,b){"use strict";return void 0!==b?"":-1!==a.tags.indexOf("glossary")?a.timeHMS+" "+'<a href="'+a.url+'">'+a.osftext+"</a>"+"\n":""},osf:function(a,b){"use strict";var c="",d=0;if(void 0!==b)return"";for("number"==typeof a.timeSec&&(c+=a.timeHMS+" "),d=0;d<a.osfline[6];d+=1)c+="-";return 0!==d&&(c+=" "),c+=a.osftext,a.url!==!1&&(c+=" <"+a.url+">"),1===a.tags.length?c+=" #"+a.tags[0]:a.tags.length>1&&(c+=" #"+a.tags.join(" #")),c+"\n"},anycast:function(a,b){"use strict";return osfExportModules.html(a,b)},source:function(a,b){"use strict";return osfExportModules.html(a,b)},wikigeeks:function(a,b){"use strict";return osfExportModules.htmllist(a,b)},md:function(a,b){"use strict";return osfExportModules.markdown(a,b)}};"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.osfExportModules=osfExportModules);